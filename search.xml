<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
    
    <entry>
      <title><![CDATA[laravel 日志在 vagrant 虚拟机中无法生成的解决]]></title>
      <url>http://yoursite.com/2016/06/12/laravel-vagrant/</url>
      <content type="html"><![CDATA[<h3 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h3><p>&#160; &#160; &#160; &#160;前段时间开始用 vagrant 在电脑上搭建 Ubuntu 、 PHP 、 Nginx 、 Mysql 环境进行开发，感觉良好。在 Windows 上搭建的环境基本上和线上环境能保持一致，在开发过程中边学边用地掌握了很多 Linux 上的命令和操作技巧。<br>&#160; &#160; &#160; &#160;之前一直在 Windows 上进行开发，前几天把项目拿到 ArchLinux 上跑，将日志记录改为每天，一下子问题就来了。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">2016/06/12 15:19:57 [error] 948#948: *1 FastCGI sent in stderr: &quot;PHP message: PHP Fatal error:  Uncaught UnexpectedValueException: The stream or file &quot;/www/popshop/storage/logs/laravel-2016-06-12.log&quot; could not be opened: failed to open stream: Permission denied in /www/popshop/vendor/monolog/monolog/src/Monolog/Handler/StreamHandler.php:97</span><br><span class="line">Stack trace:</span><br><span class="line">#0 /www/popshop/vendor/monolog/monolog/src/Monolog/Handler/RotatingFileHandler.php(88): Monolog\Handler\StreamHandler-&gt;write(Array)</span><br><span class="line">#1 /www/popshop/vendor/monolog/monolog/src/Monolog/Handler/AbstractProcessingHandler.php(37): Monolog\Handler\RotatingFileHandler-&gt;write(Array)</span><br><span class="line">#2 /www/popshop/vendor/monolog/monolog/src/Monolog/Logger.php(336): Monolog\Handler\AbstractProcessingHandler-&gt;handle(Array)</span><br><span class="line">#3 /www/popshop/vendor/monolog/monolog/src/Monolog/Logger.php(615): Monolog\Logger-&gt;addRecord(400, Object(UnexpectedValueException), Array)</span><br><span class="line">#4 /www/popshop/vendor/laravel/framework/src/Illuminate/Log/Writer.php(202): Monolog\Logger-&gt;error(Object(UnexpectedValueException), Array)</span><br><span class="line">#5 /www/popshop/vendor/laravel/framework/src/Ill...</span><br><span class="line">PHP message: PHP Fatal error:  Uncaught UnexpectedValueException: The stream or file &quot;/www/popshop/storage/logs/laravel-2016-06-12.log&quot; could not be opened: failed to open stream: Permission denied in /www/popshop/vendor/monolog/monolog/src/Monolog/Handler/StreamHandler.php:97</span><br><span class="line">Stack trace:</span><br><span class="line">#0 /www/popshop/vendor/monolog/monolog/src/Monolog/Handler/RotatingFileHandler.php(88): Monolog\Handler\StreamHandler-&gt;write(Array)</span><br><span class="line">#1 /www/popshop/vendor/monolog/monolog/src/Monolog/Handler/AbstractProcessingHandler.php(37): Monolog\Handler\RotatingFileHandler-&gt;write(Array)</span><br><span class="line">#2 /www/popshop/vendor/monolog/monolog/src/Monolog/Logger.php(336): Monolog\Handler\AbstractProcessingHandler-&gt;handle(Array)</span><br><span class="line">#3 /www/popshop/vendor/monolog/monolog/src/Monolog/Logger.php(615): Monolog\Logger-&gt;addRecord(400, Object(Symfony\Component\Debug\Exception\FatalErrorException), Array)</span><br><span class="line">#4 /www/popshop/vendor/laravel/framework/src/Illuminate/Log/Writer.php(202): Monolog\Logger-&gt;erro</span><br></pre></td></tr></table></figure></p>
<p><img src="http://7s1ryu.com1.z0.glb.clouddn.com/深度截图20160612234423.png" alt="20160612234423.png"><br>&#160; &#160; &#160; &#160;Permission denied.权限问题，文件的所有者为 vagrant 而不是 Nginx 配置中的用户 www-data ，于是上 <a href="http://stackoverflow.com/" target="_blank" rel="external">StackOverFlow</a>上搜索。看到一个情况比较相似的<a href="http://stackoverflow.com/questions/27674597/laravel-daily-log-created-with-wrong-permissions" target="_blank" rel="external">案例</a>，于是尝试最高票答案的解决方法。<br><img src="http://7s1ryu.com1.z0.glb.clouddn.com/深度截图20160612235504.png" alt="20160612235504.png"><br>&#160; &#160; &#160; &#160;结果并没有什么卵用，permission denied 报错依旧。这种解决方法只适用于解决线上出现的该问题， vagrant 中出现的这个问题要另外的解决方案。<br>&#160; &#160; &#160; &#160;其他的解决方法，例如简单粗暴地使用 crontab 在每天创建日志文件的时候将权限设为777也不实际。</p>
<h3 id="解决"><a href="#解决" class="headerlink" title="解决"></a>解决</h3><p>&#160; &#160; &#160; &#160;后来在查找 vagrant 配置时发现 vagrant 可以将挂在文件夹的所属用户进行配置，可以将文件夹的用户及用户组都设置为 www-data ，重新启动虚拟机之后再无报错。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">config.vm.synced_folder &quot;/www&quot;, &quot;/www&quot;, owner: &apos;www-data&apos;, group: &apos;www-data&apos;</span><br></pre></td></tr></table></figure></p>
<p><img src="http://7s1ryu.com1.z0.glb.clouddn.com/深度截图20160613001731.png" alt="20160613001731.png"></p>
]]></content>
    </entry>
    
  
  
</search>
